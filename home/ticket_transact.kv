

<TicketTransactionScreeen>:
    opacity:0
    size_hint: 1,1
    pos_hint: {'center_x': 0.5,'center_y': 0.5}

    main_parent : main_parent 
    back_image : back_image
    back_text : back_text
    account_name : account_name
    account_name_info : account_name_info
    account_email : account_email 
    account_loc1 : account_loc1
    account_loc2 : account_loc2
    account_loc3 : account_loc3
    account_phone1 : account_phone1
    account_phone2 : account_phone2
    account_phone3 : account_phone3

    view_remarks_button : view_remarks_button
    add_remarks_button : add_remarks_button

    refresh_layout : refresh_layout

    geolocation_step_layout : geolocation_step_layout

    BoxLayout:
        id:main_parent
        pos_hint: {'center_x': 0.5,'top': 1}
        size_hint: 1,None
        orientation: 'vertical' 

        BoxLayout:
            orientation:'horizontal'
            size_hint: 1,0.1

            
            canvas.before:
                Color:
                    rgba : chex("#ACE2E1")
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            Image:
                id: back_image
                source: root.go_back_icon if root.go_back_icon else None
                size_hint: 0.1 , 1
                # allow_stretch: True  # ✅ Allows scaling while maintaining aspect ratio
                # keep_ratio: True  # ✅ Ensures it doesn't distort
            LoginBackButton:
                id: back_text
                size_hint: 0.2,1  
                font_size: root.go_back_screen_font_size  
            
            Widget:
                size_hint: 0.7,1 


        CustomScrollView:
            id:refresh_layout
            size_hint: 1, 0.9

            
            MDGridLayout:
                id: ticket_list
                cols: 1
                adaptive_height: True
                padding: dp(0)
                spacing: dp(0)
                size_hint_y: None  

                
                AccountNumberNameLayout: 
                    canvas.before:
                        Color:
                            rgba : chex("#ACE2E1")
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    id: account_name
                    size_hint: 1, None
                    height: sp(100)

                Widget:
                    size_hint: 1, None
                    height: sp(20)
                    canvas.before:
                        Color:
                            rgba : chex("#ACE2E1")
                        Rectangle:
                            pos: self.pos
                            size: self.size

                AccountInfoLayout:  
                    id:account_name_info
                AccountInfoLayout:
                    id: account_email
                AccountInfoLayout:
                    id: account_loc1
                AccountInfoLayout:
                    id: account_loc2
                AccountInfoLayout:
                    id: account_loc3
                AccountInfoLayout:
                    id: account_phone1
                AccountInfoLayout:
                    id: account_phone2
                AccountInfoLayout:
                    id: account_phone3

                Widget:
                    size_hint: 1, None
                    height: sp(20)
                    canvas.before:
                        Color:
                            rgba : chex("#ACE2E1")
                        Rectangle:
                            pos: self.pos
                            size: self.size

                Widget:
                    size_hint: 1, None
                    height: sp(20)


                MDBoxLayout:
                    orientation:'horizontal' 
                    size_hint: 1, None
                    adaptive_height: True
                    
                    
                    Widget:
                        
                    Button:
                        id: view_remarks_button
                        text: "VIEW REMARKS"
                        size_hint: None , None
                        size: sp(120) , sp(30) 
                        font_size: sp(14)
                        color: chex("#F7EEDD")
                        font_name: 'roboto_semibold'
                        background_color: (0 , 0, 0 ,0)
 
                        canvas.before:
                            Color:
                                rgba : chex("#008DDA")
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: (4, 4 ,4 ,4)
 
                    Widget:
                        width: sp(10)  
                        size_hint: None , 1
                        
                    Button:
                        id: add_remarks_button
                        text: "ADD REMARKS" 
                        size_hint: None , None
                        size: sp(120) , sp(30) 
                        color: chex("#F7EEDD")
                        font_size: sp(14)
                        font_name: 'roboto_semibold'
                        background_color: (0 , 0, 0 ,0)
                        canvas.before:
                            Color:
                                rgba : chex("#008DDA")
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: (4, 4 ,4 ,4)

                    Widget:
                        width: sp(10)  
                        size_hint: None , 1


                
                
                Step1Layout:
                        

                GeolocationStepLayout:
                    id: geolocation_step_layout



<GeolocationModalView>:
    size_hint: 1, 1
    auto_dismiss: True
    background: ""  # Removes default dim background
    background_color: 0, 0, 0, 0

    map : map
 
    BoxLayout:
        orientation:'vertical' 
        spacing: sp(10)
        size_hint: 0.85 , 0.9
        pos_hint: { 'center_x': 0.5 , 'center_y': 0.5 }  
         
        

        MDBoxLayout:
            orientation: 'vertical'
            adaptive_height: True
            padding: (dp(10 ), dp(10) ,dp(10) , dp(10))
            spacing: dp(15)

            canvas.before:
                Color:
                    rgba: chex("#F7EEDD")
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [4]
                Color:
                    rgba: chex("#014367")
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, 4]
                    width: 2

            Label:
                text: 'Not Working? Just fill this up based on the google map'
                font_name: 'roboto_extrabold'
                font_size: sp(12)
                text_size: self.width, None   
                valign: 'top'
                halign: 'left'
                font_name: 'roboto_light' 
                color: chex("#014367") 
                size_hint: 1, None
                height: sp(30)


                
            TextInput: 
                id: location_input
                hint_text: "Enter Pin Location . . ."
                background_color: 0,0,0,0 # Makes the background transparent
                background_normal: '' # Removes default background
                padding: [0, dp(10), 0, dp(5)] # Adds some padding above and below text
                cursor_color: chex("#014367")
                multiline: False
                size_hint: 1, None
                height: sp(30)
                font_name: 'roboto_light'
                foreground_color: chex("#014367")
                font_size: sp(13)
                
                canvas.after:
                    Color:
                        rgba: chex("#014367")
                    Line:
                        points: [self.x, self.y, self.x + self.width, self.y]
                        width: 1.3
                    Color:
                        rgba: chex("#014367") 
            
            BoxLayout:
                orientation: 'horizontal' 
                size_hint: 1, None 
                height: sp(24)
                padding: (0, 0,  0, 0) 

                Widget:
                    size_hint: 1, None

                Button:
                    size_hint: None, 1 
                    width: sp(100)
                    text: "SUBMIT"
                    background_color: (0, 0, 0, 0)
                    background_down: ''
                    font_name: 'roboto_semibold'
                    font_size: sp(13)
                    color: chex("#F7EEDD")
                    canvas.before:
                        Color:
                            rgba: chex("#5CBA45")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4]
                            


        MDBoxLayout:
            orientation: 'vertical' 
            padding: (dp(10 ), dp(10) ,dp(10) , dp(10)) 
            size_hint: (1 , 1)

            canvas.before:
                Color:
                    rgba: chex("#F7EEDD")
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [4]
                Color:
                    rgba: chex("#014367")
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, 4]
                    width: 2


            Label:
                text: 'Take Screenshot when using this for POC'
                font_name: 'roboto_extrabold'
                font_size: sp(12)
                text_size: self.width, None   
                valign: 'center'
                halign: 'center' 
                color: chex("#014367") 
                size_hint: 1, 0.1   
        
            FloatLayout:
                size_hint: 1, 0.9  # Full size for the map view
                id: map

            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, None
                height: sp(25)

                Label:
                    text: root.lat
                    size_hint_x: 0.5   
                    size_hint_y: 1
                    text_size: self.size
                    valign: 'center'
                    halign: 'left'
                    font_name: 'roboto_light'
                    font_size: sp(9)
                    color: chex("#014367")    
                    markup: True

                Label:
                    text: root.lon
                    size_hint_x: 0.5   
                    size_hint_y: 1
                    text_size: self.size
                    valign: 'center'
                    halign: 'left'
                    font_name: 'roboto_light'
                    font_size: sp(9)
                    color: chex("#014367")    
                    markup: True
                    
                        
                    

            MDBoxLayout:
                orientation: 'horizontal'
                adaptive_height: True

                Button:
                    text: 'CANCEL' 
                    font_name: "roboto_semibold" 
                    background_color: (0, 0 , 0, 0)
                    width: sp(130)  
                    font_size: sp(12)
                    color: chex("#F7EEDD")
                    canvas.before:
                        Color:
                            rgba: chex("#B71E1E")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4]
                    on_release:
                        root.dismiss()
                
                Widget:
                    size_hint: 1, None 
                    height: sp(25)

                Button:
                    text: 'SUBMIT' 
                    font_name: "roboto_semibold" 
                    background_color: (0, 0 , 0, 0)
                    width: sp(130) 
                    height: sp(25)
                    font_size: sp(12)
                    color: chex("#F7EEDD")
                    canvas.before:
                        Color:
                            rgba: chex("#5CBA45")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4]





<GeolocationStepLayout>:
    orientation: 'vertical'
    # adaptive_height: True
    padding: ( 0 , dp(20), 0, 0)
    size_hint: 1, None
    height: dp(300)
    

    set_location_button : set_location_button
    next_step_button : next_step_button
    location_info : location_info


    BoxLayout:
        orientation:'horizontal'
        size_hint: 1, None
        height: dp(30)
        padding: (dp(20), 0 ,dp(20) , 0)

        Label:
            text: root.step_text
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_extrabold'
            font_size: sp(15)
            color: chex("#014367")
        
        MDIcon: 
            icon: "check-decagram"
            font_size: sp(20)
            color: chex("#ACE2E1") if root.is_not_done else chex("#5CBA45")


    MDBoxLayout:
        orientation: 'vertical'
        adaptive_height: True 
        padding: (dp(40), dp(10) , dp(20), 0)
        spacing:dp(10)
        
        Label:
            text:'Instructions :'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(13)
            color: chex("#014367")


        Label:
            text:'1. Click Submit Geo-Mapping to provide location details.'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

            
        Label:
            text:'2. Verify that the geo-mapping data is accurate before submitting.'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

            
        Label:
            text:'3. Once submitted, proceed to the next step for final checks.'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

        
    BoxLayout:
        id: location_info
        orientation: 'horizontal'
        size_hint: 1, None
        height: sp(30)
        padding: (dp(40), dp(40), 0, 0)

        MDIcon: 
            icon: "home-map-marker"
            font_size: sp(20)
            color: chex("#014367")
            size_hint: None, 1
            width: sp(50)

        Label:
            text: 'Latitude : '
            size_hint: None, 1
            width: sp(80)
            text_size: self.size
            valign: 'center'
            halign: 'right'
            font_name: 'roboto_semibold'
            font_size: sp(11)
            color: chex("#014367")

        Label:
            text: root.latitude
            size_hint_x: 1  # ✅ Take remaining space
            size_hint_y: 1
            text_size: self.size
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

             
    BoxLayout:
        orientation: 'horizontal'
        size_hint: 1, None
        height: sp(30)
        padding: (dp(40), dp(40), 0, 0)

        
        MDIcon: 
            icon: "home-map-marker"
            font_size: sp(20)
            color: chex("#014367")
            size_hint: None, 1
            width: sp(50)
            opacity: 0

        Label:
            text: 'Longitude : '
            size_hint: None, 1
            width: sp(80)
            text_size: self.size
            valign: 'center'
            halign: 'right'
            font_name: 'roboto_semibold'
            font_size: sp(11)
            color: chex("#014367")

        Label:
            text: root.longitude
            size_hint_x: 1  # ✅ Take remaining space
            size_hint_y: 1
            text_size: self.size
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

    MDBoxLayout:
        orientation: 'horizontal'
        adaptive_height: True
        padding: (0 , dp(30) , dp(20), 0)
        spacing: dp(10)

        Widget:
            
            
        Button:
            id: set_location_button
            text: "SET LOCATION" 
            font_name: "roboto_semibold"
            size_hint: None , None
            background_color: (0, 0 , 0, 0)
            width: sp(100) 
            height: sp(25)
            font_size: sp(12)
            color: chex("#F7EEDD")
            canvas.before:
                Color:
                    rgba: chex("#014367")
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [4]
            on_release:
                root.parent_event() if root.parent_event else None

    
        Button:
            id: next_step_button
            text: "NEXT STEP" 
            font_name: "roboto_semibold"
            size_hint: None , None
            background_color: (0, 0 , 0, 0)
            width: sp(100) 
            height: sp(25)
            font_size: sp(12)
            color: chex("#F7EEDD")
            canvas.before:
                Color:
                    rgba: chex("#5CBA45")
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [4]



<Step1Layout>:
    orientation: 'vertical'
    adaptive_height: True
    padding: ( 0 , dp(20), 0, 0)

    BoxLayout:
        orientation:'horizontal'
        size_hint: 1, None
        height: dp(30)
        padding: (dp(20), 0 ,dp(20) , 0)

        Label:
            text:'Step 1: Initial Assessment'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_extrabold'
            font_size: sp(15)
            color: chex("#014367")
        
        MDIcon: 
            icon: "check-decagram"
            font_size: sp(20)
            color: chex("#ACE2E1") if root.is_not_done else chex("#5CBA45")
        
 

    MDBoxLayout:
        orientation: 'vertical'
        adaptive_height: True 
        padding: (dp(40), dp(10) , dp(20), 0)
        spacing:dp(10)
        
        Label:
            text:'Instructions :'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(13)
            color: chex("#014367")


        Label:
            text:'1. Click Next Step or Activate Account to proceed with the ticket.'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

            
        Label:
            text:'2. Review the ticket details and ensure all necessary information is correct.'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")

            
        Label:
            text:'3. If additional remarks are needed, click Add Remark before proceeding.'
            text_size: self.width, None 
            size_hint_y: None
            height: self.texture_size[1]
            valign: 'center'
            halign: 'left'
            font_name: 'roboto_light'
            font_size: sp(11)
            color: chex("#014367")


    MDBoxLayout:
        orientation: 'horizontal'
        adaptive_height: True
        padding: (0 , dp(20) , dp(20), 0)

        Widget:
    
        Button:
            text: "NEXT STEP" if root.old_account else "ACTIVATE ACCOUNT"
            font_name: "roboto_semibold"
            size_hint: None , None
            background_color: (0, 0 , 0, 0)
            width: sp(130) 
            height: sp(25)
            font_size: sp(12)
            color: chex("#F7EEDD")
            canvas.before:
                Color:
                    rgba: chex("#5CBA45")
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [4]



<RemarksListViewer>: 
    size_hint: 1, 1
    auto_dismiss: False
    background: ""  # Removes default dim background
    background_color: 0, 0, 0, 0
 

    BoxLayout:
        orientation:'vertical'
        padding: sp(20)
        spacing: sp(10)
        size_hint: 0.85 , 0.9
        pos_hint: { 'center_x': 0.5 , 'center_y': 0.5 }  
         
        
        canvas.before:
            Color:
                rgba: chex("#F7EEDD")
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [10]
            Color:
                rgba: chex("#014367")
            Line:
                width: 2
                rounded_rectangle: (*self.pos, *self.size, 10)

        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1 , None
            height: sp(30)

            Label:
                text: "Remarks ;"
                text_size: self.width, None 
                size_hint_y: None
                height: self.texture_size[1]
                valign: 'top'
                halign: 'left'
                font_name: 'roboto_light'
                font_size: sp(15)
                color: chex("#014367") 
                markup: True
            
            Button:
                text: "CLOSE" 
                font_name: "roboto_semibold"
                size_hint: None , 1
                background_color: (0, 0 , 0, 0)
                width: sp(100) 
                font_size: sp(12)
                on_release: root.dismiss()
                color: chex("#F7EEDD")
                canvas.before:
                    Color:
                        rgba: chex("#B71E1E")
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [4]

        ScrollView: 
            MDGridLayout:
                cols: 1
                adaptive_height: True
                padding: dp(10)
                spacing: dp(10)
                size_hint_y: None

                Remark:
                Remark:
                Remark:

<Remark>:
    padding: dp(10), dp(10)
    size_hint_x: 0.75
    size_hint_y: None
    height: self.minimum_height

    canvas.before:
        Color:
            rgba: chex("#ACE2E1")
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [4]

    Label:
        text: root.remark_text
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]
        valign: 'top'
        halign: 'left'
        font_name: 'roboto_light'
        font_size: sp(15)
        color: chex("#014367")



<RemarksInputLayout>:
    size_hint: 1, 1
    auto_dismiss: False
    background: ""  # Removes default dim background
    background_color: 0, 0, 0, 0

    remark_text : remark_text

    RelativeLayout:
        size_hint: 1, 1
    
        BoxLayout:
            orientation: 'vertical' 
            padding: sp(20)
            spacing: sp(10)
            size_hint: 0.85 , 0.5
            pos_hint: { 'center_x': 0.5 , 'top': 0.95 }  

            canvas.before:
                Color:
                    rgba: chex("#F7EEDD")
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [10]
                Color:
                    rgba: chex("#014367")
                Line:
                    width: 2
                    rounded_rectangle: (*self.pos, *self.size, 10)


            Label:
                text: "Fill this up and hit submit to add this remarks" 
                halign: "center" 
                size_hint: 1, 0.1
                font_size: sp(11)
                color: chex("#014367")  # This is the actual text color
                font_name: 'roboto_extrabold'

            TextInput: 
                id: remark_text
                hint_text: "Provide your remarks here . . ." 
                multiline: True 
                size_hint: 1, 0.8
                background_color: 0, 0, 0, 0  # Transparent
                foreground_color: chex("#014367")  # This is the actual text color
                cursor_color: chex("#014367")  # Optional, to see the cursor better
                font_name: 'roboto_light'
                font_size: sp(10)
                padding: dp(10), dp(10)  # Add padding for readability

                canvas.before:
                    Color:
                        rgba: chex("#D9D9D9") #
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [4]
                    Color:
                        rgba: chex("#014367") 


            BoxLayout:
                size_hint: 1 , 0.1
                spacing: sp(10)

                Button:
                    text: "CLOSE" 
                    size_hint: None , 1
                    background_color: (0, 0 , 0, 0)
                    color: chex("#F7EEDD")
                    width: sp(100) 
                    font_size: sp(12)
                    on_release: root.dismiss()
                    canvas.before:
                        Color:
                            rgba: chex("#B71E1E")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4]

                Widget:
                    

                Button:
                    text: "SUBMIT" 
                    size_hint: None , 1
                    background_color: (0, 0 , 0, 0)
                    width: sp(100) 
                    font_size: sp(12)
                    opacity: 1 if root.is_ready_to_submit else 0.5
                    color: chex("#F7EEDD")
                    canvas.before:
                        Color:
                            rgba: chex("#5CBA45")
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [4]






















<AccountInfoLayout>:
    size_hint_x: 1
    adaptive_height: True
    orientation: 'horizontal'

    info_label : info_label
 
    canvas.before:
        Color:
            rgba : chex("#ACE2E1")
        Rectangle:
            pos: self.pos
            size: self.size

    RelativeLayout:
        pos_hint: {'top': 1}
        size_hint_x: 0.25
        size_hint_y: None
        height: sp(30) 
 
        MDIcon:
            icon: root.icon_image
            font_size: sp(20)
            color: chex("#014367")
            pos_hint: {'center_x': 0.7, 'top': 1}

    Label:
        id: info_label
        text: root.account_info
        text_size: self.width, None
        size_hint_x: 0.75
        size_hint_y: None
        height: self.texture_size[1]
        valign: 'top'
        halign: 'left'
        font_name: 'roboto_light'
        font_size: sp(15)
        color: chex("#014367")
        pos_hint: {'top': 0.9}
        markup: True
        



<AccountNumberNameLayout>:
    orientation: 'horizontal'


    RelativeLayout:
        size_hint: 0.3 , 1 
        
        Image:
            # size : 0 , sp(100)
            pos_hint: {'center_x' : 0.5, 'center_y' : 0.5}
            size_hint: None, None
            size: sp(60) , sp(60)
            allow_stretch: True
            keep_ratio: True            
            source: root.account_image

    BoxLayout:
        orientation: 'vertical'
        size_hint: 0.7 , 1

        Label:
            text_size: self.size
            valign: 'middle'
            halign: 'left'
            text: "Account Number;"
            size_hint: 1 , 0.3
            font_name: 'roboto_light'
            font_size: sp(15)
            color: chex("#000000")

        Label:
            text:'64773198'
            size_hint: 1 , 0.7
            font_name: 'roboto_extrabold'
            font_size: sp(30)
            color: chex("#014367")
            text_size: self.size
            valign: 'middle'
            halign: 'center'








